<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge'>
	<title>EduPass | Learning Platform</title>
	<link rel='icon' type='image/svg+xml' href='logo.svg'>
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i|Roboto+Condensed:400,700' rel='stylesheet'>
	<link rel='stylesheet' type='text/css' media='screen' href='../common.css'>
	<link rel='stylesheet' type='text/css' media='screen' href='../layout.css'>
	<style>
	#course-table {
		width: 100%;
		display: flex;
		flex-wrap: wrap;
	}
	.course-generic {
		height: 200px;
		width: 350px;
		background-color: #ccc;
		margin: 10px;
		float: left;
		font-size: 28px;
		padding: 8px;
		border-radius: 12px;
		cursor: pointer;
	}
	.teacher {
		font-size: 20px;
	}
	.assignmentCount {
		font-size: 16px;
		font-weight: 500;
		border-radius: 16px;
		height: 30px;
		line-height: 30px;
		white-space: nowrap;
		max-width: 90%;
		background-color: red;
		color: white;
		text-align: center;
	}
	.assignments{
		font-size: 16px;
		font-weight: 500;
		border-radius: 16px;
		line-height: 30px;
		white-space: nowrap;
		background-color: blue;
		color: white;
		text-align: center;
		position:absolute;
	}
	</style>
</head>
<body>
	<nav>
		<a><img src='../assets/icons/learning.svg'>Placeholder</a>
		<a><img src='../assets/icons/learning.svg'>Potato Alistair</a>
	</nav>
	<main>
		<h1>My Courses</h1>
		<div id="course-table">
		</div>
	</main>
	<script type="text/javascript" src="coursedata.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const COURSES = coursedata;
			const COURSE_TABLE = document.getElementById('course-table');
			COURSES.forEach(course => {
				const PARENT = document.createElement('div');
				PARENT.classList.add('course-generic');
				PARENT.setAttribute('id',course.id);
				PARENT.appendChild(document.createTextNode(course.name));
				PARENT.dataset.id = course.id;

				const TEACHER = document.createElement('div');
				TEACHER.classList.add('teacher');
				TEACHER.appendChild(document.createTextNode(course.teacher));
				PARENT.appendChild(TEACHER);

				if (course.assignments.length > 0) {
					const ASSIGNMENTS = document.createElement('div');
					ASSIGNMENTS.classList.add('assignmentCount');
					ASSIGNMENTS.appendChild(document.createTextNode(`${course.assignments.length} outstanding assignment${course.assignments.length == 1 ? '' : 's'}`));
					const ALIST=document.createElement('div');
					ALIST.classList.add('assignments');
					const ul=document.createElement('div');
					ul.classList.add('assignments');
					ul.style.display='none'; //probably horrible coding but I'll take it if it works zzz
					for (let i = 0; i < course.assignments.length; i++) {
						const AS=document.createElement('div');
						AS.style.margin='7px';
						AS.appendChild(document.createTextNode(course.assignments[i].name));
						ul.appendChild(AS);
					}
						ASSIGNMENTS.addEventListener('mouseover',()=>{
							ul.style.display='block';
							ASSIGNMENTS.addEventListener('mousemove',point =>{
								ul.style.left=(point.clientX+10)+'px';
								ul.style.top=(point.clientY+10)+'px';
							});
							ASSIGNMENTS.addEventListener('mouseout', () => {
							// close above
							ul.style.display='none';
							});
						});
					ASSIGNMENTS.appendChild(ul);
					ASSIGNMENTS.appendChild(ALIST);
					PARENT.appendChild(ASSIGNMENTS);
				}

				COURSE_TABLE.appendChild(PARENT);
			});
			// performant event listener for multiple elements
			// see https://www.kirupa.com/html5/handling_events_for_many_elements.htm
			COURSE_TABLE.addEventListener('click', e => {
				e.preventDefault();
				if (e.target !== e.currentTarget) {
					let element = e.target;
					while (element.parentElement !== COURSE_TABLE) element = element.parentElement;
				}
				window.location.href=`ASDisplay.html?courseid=${e.target.getAttribute('id')}`;
				e.stopPropagation();
			});
		});
		</script>
</body>
</html>